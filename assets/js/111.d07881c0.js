(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{466:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_11-1-接口是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-接口是什么"}},[t._v("#")]),t._v(" 11.1 接口是什么")]),t._v(" "),a("p",[t._v("Go 语言不是一种 "),a("em",[t._v("“传统”")]),t._v(" 的面向对象编程语言：它里面没有类和继承的概念。")]),t._v(" "),a("p",[t._v("但是 Go 语言里有非常灵活的 "),a("strong",[t._v("接口")]),t._v(" 概念，通过它可以实现很多面向对象的特性。接口提供了一种方式来 "),a("strong",[t._v("说明")]),t._v(" 对象的行为：如果谁能搞定这件事，它就可以用在这儿。")]),t._v(" "),a("p",[t._v("接口定义了一组方法（方法集），但是这些方法不包含（实现）代码：它们没有被实现（它们是抽象的）。接口里也不能包含变量。")]),t._v(" "),a("p",[t._v("通过如下格式定义接口：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Namer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Method1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" return_type\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Method2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" return_type\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("上面的 "),a("code",[t._v("Namer")]),t._v(" 是一个 "),a("strong",[t._v("接口类型")]),t._v("。")]),t._v(" "),a("p",[t._v("（按照约定，只包含一个方法的）接口的名字由方法名加 "),a("code",[t._v("[e]r")]),t._v(" 后缀组成，例如 "),a("code",[t._v("Printer")]),t._v("、"),a("code",[t._v("Reader")]),t._v("、"),a("code",[t._v("Writer")]),t._v("、"),a("code",[t._v("Logger")]),t._v("、"),a("code",[t._v("Converter")]),t._v(" 等等。还有一些不常用的方式（当后缀 "),a("code",[t._v("er")]),t._v(" 不合适时），比如 "),a("code",[t._v("Recoverable")]),t._v("，此时接口名以 "),a("code",[t._v("able")]),t._v(" 结尾，或者以 "),a("code",[t._v("I")]),t._v(" 开头（像 "),a("code",[t._v(".NET")]),t._v(" 或 "),a("code",[t._v("Java")]),t._v(" 中那样）。")]),t._v(" "),a("p",[t._v("Go 语言中的接口都很简短，通常它们会包含 0 个、最多 3 个方法。")]),t._v(" "),a("p",[t._v("不像大多数面向对象编程语言，在 Go 语言中接口可以有值，一个接口类型的变量或一个 "),a("strong",[t._v("接口值")]),t._v(" ："),a("code",[t._v("var ai Namer")]),t._v("，"),a("code",[t._v("ai")]),t._v(" 是一个多字（multiword）数据结构，它的值是 "),a("code",[t._v("nil")]),t._v("。它本质上是一个指针，虽然不完全是一回事。指向接口值的指针是非法的，它们不仅一点用也没有，还会导致代码错误。")]),t._v(" "),a("p",[a("img",{attrs:{src:"images/11.1_fig11.1.jpg?raw=true",alt:""}})]),t._v(" "),a("p",[t._v("此处的方法指针表是通过运行时反射能力构建的。")]),t._v(" "),a("p",[t._v("类型（比如结构体）实现接口方法集中的方法，每一个方法的实现说明了此方法是如何作用于该类型的："),a("strong",[t._v("即实现接口")]),t._v("，同时方法集也构成了该类型的接口。实现了 "),a("code",[t._v("Namer")]),t._v(" 接口类型的变量可以赋值给 "),a("code",[t._v("ai")]),t._v(" （接收者值），此时方法表中的指针会指向被实现的接口方法。当然如果另一个类型（也实现了该接口）的变量被赋值给 "),a("code",[t._v("ai")]),t._v("，这二者（译者注：指针和方法实现）也会随之改变。")]),t._v(" "),a("p",[a("strong",[t._v("类型不需要显式声明它实现了某个接口：接口被隐式地实现。多个类型可以实现同一个接口")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("实现某个接口的类型（除了实现接口方法外）可以有其他的方法")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("一个类型可以实现多个接口")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("接口类型可以包含一个实例的引用， 该实例的类型实现了此接口（接口是动态类型）")]),t._v("。")]),t._v(" "),a("p",[t._v("即使接口在类型之后才定义，二者处于不同的包中，被单独编译：只要类型实现了接口中的方法，它就实现了此接口。")]),t._v(" "),a("p",[t._v("所有这些特性使得接口具有很大的灵活性。")]),t._v(" "),a("p",[t._v("第一个例子：")]),t._v(" "),a("p",[t._v("示例 11.1 "),a("a",{attrs:{href:"examples/chapter_11/interfaces.go"}},[t._v("interfaces.go")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Shaper "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Square "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tside "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Square"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("side "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("side\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tsq1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Square"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tsq1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("side "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" areaIntf Shaper\n\tareaIntf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sq1\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// shorter,without separate declaration:")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// areaIntf := Shaper(sq1)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or even:")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// areaIntf := sq1")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The square has area: %f\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" areaIntf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("The square has area: 25.000000\n")])])]),a("p",[t._v("上面的程序定义了一个结构体 "),a("code",[t._v("Square")]),t._v(" 和一个接口 "),a("code",[t._v("Shaper")]),t._v("，接口有一个方法 "),a("code",[t._v("Area()")]),t._v("。")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("main()")]),t._v(" 方法中创建了一个 "),a("code",[t._v("Square")]),t._v(" 的实例。在主程序外边定义了一个接收者类型是 "),a("code",[t._v("Square")]),t._v(" 方法的 "),a("code",[t._v("Area()")]),t._v("，用来计算正方形的面积：结构体 "),a("code",[t._v("Square")]),t._v(" 实现了接口 "),a("code",[t._v("Shaper")]),t._v(" 。")]),t._v(" "),a("p",[t._v("所以可以将一个 "),a("code",[t._v("Square")]),t._v(" 类型的变量赋值给一个接口类型的变量："),a("code",[t._v("areaIntf = sq1")]),t._v(" 。")]),t._v(" "),a("p",[t._v("现在接口变量包含一个指向 "),a("code",[t._v("Square")]),t._v(" 变量的引用，通过它可以调用 "),a("code",[t._v("Square")]),t._v(" 上的方法 "),a("code",[t._v("Area()")]),t._v("。当然也可以直接在 "),a("code",[t._v("Square")]),t._v(" 的实例上调用此方法，但是在接口实例上调用此方法更令人兴奋，它使此方法更具有一般性。接口变量里包含了接收者实例的值和指向对应方法表的指针。")]),t._v(" "),a("p",[t._v("这是 "),a("strong",[t._v("多态")]),t._v(" 的 Go 版本，多态是面向对象编程中一个广为人知的概念：根据当前的类型选择正确的方法，或者说：同一种类型在不同的实例上似乎表现出不同的行为。")]),t._v(" "),a("p",[t._v("如果 "),a("code",[t._v("Square")]),t._v(" 没有实现 "),a("code",[t._v("Area()")]),t._v(" 方法，编译器将会给出清晰的错误信息：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("cannot use sq1 (type *Square) as type Shaper in assignment:\n*Square does not implement Shaper (missing Area method)\n")])])]),a("p",[t._v("如果 "),a("code",[t._v("Shaper")]),t._v(" 有另外一个方法 "),a("code",[t._v("Perimeter()")]),t._v("，但是"),a("code",[t._v("Square")]),t._v(" 没有实现它，即使没有人在 "),a("code",[t._v("Square")]),t._v(" 实例上调用这个方法，编译器也会给出上面同样的错误。")]),t._v(" "),a("p",[t._v("扩展一下上面的例子，类型 "),a("code",[t._v("Rectangle")]),t._v(" 也实现了 "),a("code",[t._v("Shaper")]),t._v(" 接口。接着创建一个 "),a("code",[t._v("Shaper")]),t._v(" 类型的数组，迭代它的每一个元素并在上面调用 "),a("code",[t._v("Area()")]),t._v(" 方法，以此来展示多态行为：")]),t._v(" "),a("p",[t._v("示例 11.2 "),a("a",{attrs:{href:"examples/chapter_11/interfaces_poly.go"}},[t._v("interfaces_poly.go")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Shaper "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Square "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tside "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Square"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("side "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("side\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Rectangle "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlength"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" width "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r Rectangle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\tr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" Rectangle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Area() of Rectangle needs a value")]),t._v("\n\tq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Square"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Area() of Square needs a pointer")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// shapes := []Shaper{Shaper(r), Shaper(q)}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or shorter")]),t._v("\n\tshapes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Shaper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" q"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Looping through shapes for area ..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" shapes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Shape details: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shapes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Area of this shape is: "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shapes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Area")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("Looping through shapes for area ...\nShape details:  {5 3}\nArea of this shape is:  15\nShape details:  &{5}\nArea of this shape is:  25\n")])])]),a("p",[t._v("在调用 "),a("code",[t._v("shapes[n].Area()")]),t._v(" 这个时，只知道 "),a("code",[t._v("shapes[n]")]),t._v(" 是一个 "),a("code",[t._v("Shaper")]),t._v(" 对象，最后它摇身一变成为了一个 "),a("code",[t._v("Square")]),t._v(" 或 "),a("code",[t._v("Rectangle")]),t._v(" 对象，并且表现出了相对应的行为。")]),t._v(" "),a("p",[t._v("也许从现在开始你将看到通过接口如何产生 "),a("strong",[t._v("更干净")]),t._v("、"),a("strong",[t._v("更简单")]),t._v(" 及 "),a("strong",[t._v("更具有扩展性")]),t._v(" 的代码。在 11.12.3 中将看到在开发中为类型添加新的接口是多么的容易。")]),t._v(" "),a("p",[t._v("下面是一个更具体的例子：有两个类型 "),a("code",[t._v("stockPosition")]),t._v(" 和 "),a("code",[t._v("car")]),t._v("，它们都有一个 "),a("code",[t._v("getValue()")]),t._v(" 方法，我们可以定义一个具有此方法的接口 "),a("code",[t._v("valuable")]),t._v("。接着定义一个使用 "),a("code",[t._v("valuable")]),t._v(" 类型作为参数的函数 "),a("code",[t._v("showValue()")]),t._v("，所有实现了 "),a("code",[t._v("valuable")]),t._v(" 接口的类型都可以用这个函数。")]),t._v(" "),a("p",[t._v("示例 11.3 "),a("a",{attrs:{href:"examples/chapter_11/valuable.go"}},[t._v("valuable.go")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" stockPosition "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tticker     "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\tsharePrice "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n\tcount      "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* method to determine the value of a stock position */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s stockPosition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sharePrice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" car "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("make")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\tmodel "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\tprice "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* method to determine the value of a car */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c car"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("price\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* contract that defines different things that have value */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" valuable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float32")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("asset valuable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Value of the asset is %f\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" asset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" o valuable "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stockPosition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GOOG"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("577.20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\to "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" car"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BMW"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"M3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("66500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("showValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("Value of the asset is 2308.800049\nValue of the asset is 66500.000000\n")])])]),a("p",[a("strong",[t._v("一个标准库的例子")])]),t._v(" "),a("p",[a("code",[t._v("io")]),t._v(" 包里有一个接口类型 "),a("code",[t._v("Reader")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Reader "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("定义变量 "),a("code",[t._v("r")]),t._v("："),a("code",[t._v("var r io.Reader")])]),t._v(" "),a("p",[t._v("那么就可以写如下的代码：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" r io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Reader\n\tr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Stdin    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// see 12.1")]),t._v("\n\tr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bufio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bufio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("上面 "),a("code",[t._v("r")]),t._v(" 右边的类型都实现了 "),a("code",[t._v("Read()")]),t._v(" 方法，并且有相同的方法签名，"),a("code",[t._v("r")]),t._v(" 的静态类型是 "),a("code",[t._v("io.Reader")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("备注")])]),t._v(" "),a("p",[t._v("有的时候，也会以一种稍微不同的方式来使用接口这个词：从某个类型的角度来看，它的接口指的是：它的所有导出方法，只不过没有显式地为这些导出方法额外定一个接口而已。")]),t._v(" "),a("p",[a("strong",[t._v("练习 11.1")]),t._v(" simple_interface.go：")]),t._v(" "),a("p",[t._v("定义一个接口 "),a("code",[t._v("Simpler")]),t._v("，它有一个 "),a("code",[t._v("Get()")]),t._v(" 方法和一个 "),a("code",[t._v("Set()")]),t._v("，"),a("code",[t._v("Get()")]),t._v("返回一个整型值，"),a("code",[t._v("Set()")]),t._v(" 有一个整型参数。创建一个结构体类型 "),a("code",[t._v("Simple")]),t._v(" 实现这个接口。")]),t._v(" "),a("p",[t._v("接着定一个函数，它有一个 "),a("code",[t._v("Simpler")]),t._v(" 类型的参数，调用参数的 "),a("code",[t._v("Get()")]),t._v(" 和 "),a("code",[t._v("Set()")]),t._v(" 方法。在 "),a("code",[t._v("main")]),t._v(" 函数里调用这个函数，看看它是否可以正确运行。")]),t._v(" "),a("p",[a("strong",[t._v("练习 11.2")]),t._v(" interfaces_poly2.go：")]),t._v(" "),a("p",[t._v("a) 扩展 interfaces_poly.go 中的例子，添加一个 "),a("code",[t._v("Circle")]),t._v(" 类型")]),t._v(" "),a("p",[t._v("b) 使用一个抽象类型 "),a("code",[t._v("Shape")]),t._v("（没有字段） 实现同样的功能，它实现接口 "),a("code",[t._v("Shaper")]),t._v("，然后在其他类型里内嵌此类型。扩展 10.6.5 中的例子来说明覆写。")]),t._v(" "),a("h2",{attrs:{id:"链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#链接"}},[t._v("#")]),t._v(" 链接")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/go-doc/directory.html"}},[t._v("目录")])],1),t._v(" "),a("li",[t._v("上一节："),a("RouterLink",{attrs:{to:"/go-doc/11.0.html"}},[t._v("接口（Interfaces）与反射（reflection）")])],1),t._v(" "),a("li",[t._v("下一节："),a("RouterLink",{attrs:{to:"/go-doc/11.2.html"}},[t._v("接口嵌套接口")])],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);